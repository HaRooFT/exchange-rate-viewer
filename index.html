<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>환율 변환기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .exchange-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            width: 350px;
        }
        h2 {
            text-align: center;
        }
        .exchange-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .exchange-card:last-child {
            border-bottom: none;
        }
        .currency {
            font-weight: bold;
        }
        .amount {
            font-size: 1.2em;
            font-weight: bold;
        }
        .time-info {
            text-align: center;
            font-size: 0.9em;
            color: gray;
            margin-top: 10px;
        }
    </style>
<script>
    async function getExchangeRate() {
        document.getElementById("amount").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                getExchangeRate();
            }
        });
        const baseCurrency = document.getElementById("baseCurrency").value;
        const amount = parseFloat(document.getElementById("amount").value) || 1;
        const targetCurrencies = ["KRW", "USD", "CNH", "JPY", "EGP", "THB"];
        // const url = `http://localhost:3000/exchange-rate`;  ❌ 기존 코드
		const url = `https://seastorys2.synology.me:3000/exchange-rate`; // ✅ 이렇게 수정


        try {
            const response = await fetch(url);
            const data = await response.json();

            if (!Array.isArray(data) || data.length === 0) {
                document.getElementById("result").innerText = "환율 정보를 가져올 수 없습니다.";
                return;
            }

            console.log("API 응답 데이터:", data); // 데이터 구조 확인용

            let resultHTML = "";

            // 기준 통화의 환율 데이터 가져오기
            let baseCurrencyData = data.find(item => item.cur_unit === baseCurrency);
            if (!baseCurrencyData) {
                if (baseCurrency === "CNY") baseCurrencyData = data.find(item => item.cur_unit === "CNH");
                if (baseCurrency === "JPY") baseCurrencyData = data.find(item => item.cur_unit === "JPY(100)");
            }
            if (!baseCurrencyData) {
                document.getElementById("result").innerText = "기준 통화의 환율 정보를 찾을 수 없습니다.";
                return;
            }

            const baseRate = parseFloat(baseCurrencyData.deal_bas_r.replace(/,/g, ''));

            targetCurrencies.forEach(currency => {
                let searchCurrency = currency;
                if (currency === "CNY") searchCurrency = "CNH"; // CNY가 CNH로 제공될 경우 대응
                if (currency === "JPY") searchCurrency = "JPY(100)"; // JPY가 JPY(100)으로 제공될 경우 대응
                
                const currencyData = data.find(item => item.cur_unit === searchCurrency);
                if (!currencyData) {
                    resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>N/A</span></div>`;
                    return;
                }

                let targetRate = parseFloat(currencyData.deal_bas_r.replace(/,/g, ''));
                if (currency === "JPY") targetRate /= 100; // JPY(100) 기준을 JPY(1) 기준으로 변환

                let convertedAmount;
                if (baseCurrency === "KRW") {
                    // 기준 통화가 KRW일 경우: KRW → 대상 통화 변환
                    convertedAmount = (amount / targetRate).toFixed(2);
                } else if (currency === "KRW") {
                    // 대상 통화가 KRW일 경우: 기준 통화 → KRW 변환
                    convertedAmount = (amount * baseRate).toFixed(2);
                } else {
                    // 그 외 (예: USD → CNY 변환): 기준 통화를 KRW로 변환한 후 대상 통화로 변환
                    const amountInKRW = amount * baseRate;
                    convertedAmount = (amountInKRW / targetRate).toFixed(2);
                }

                convertedAmount = Number(convertedAmount).toLocaleString();
                let displayAmount = currency === "KRW" ? `${convertedAmount} 원` : `${convertedAmount} ${currency}`;
                resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>${displayAmount}</span></div>`;
            });

            document.getElementById("result").innerHTML = resultHTML;

            // 📅 기준 시간 표시 (서버에서 받은 최신 환율 데이터 기준)
            const updateTimeStr = data[0]?.date || new Date().toISOString(); // API 응답 구조에 따라 수정
            const updateTime = new Date(updateTimeStr);
            const formattedTime = updateTime.toLocaleString("ko-KR", {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
                hour12: false
            });

            document.getElementById("timeInfo").innerText = `📅 최신 환율 데이터 기준
(날짜: ${updateTimeStr})`; 

        } catch (error) {
            console.error("API 요청 오류:", error);
            document.getElementById("result").innerText = "데이터를 불러오는 중 오류 발생.";
        }
    }
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("amount").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            getExchangeRate();
        }
    });
});
</script>
</head>
<body>
    <div class="exchange-container">
        <h2 id="title">환율 변환기</h2>
        <label for="baseCurrency">기준 통화:</label>
        <select id="baseCurrency">
            <option value="KRW">한국(KRW)</option>
            <option value="USD">미국(USD)</option>
            <option value="CNH">중국(CNH)</option>
            <option value="JPY">일본(JPY)</option>
            <option value="EGP">이집트(EGP)</option>
            <option value="THB">태국(THB)</option>
        </select>
        <br><br>
        <label for="amount">금액 입력:</label>
        <input type="number" id="amount" value="" min="0" step="0.01">
        <br><br>
        <button onclick="getExchangeRate()">환율 조회</button>
        <div id="result"></div>
        <p id="timeInfo" class="time-info"></p>
    </div>
</body>
</html>
