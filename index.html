<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ìœ¨ ë³€í™˜ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .exchange-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            width: 350px;
        }
        h2 {
            text-align: center;
        }
        .exchange-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .exchange-card:last-child {
            border-bottom: none;
        }
        .currency {
            font-weight: bold;
        }
        .amount {
            font-size: 1.2em;
            font-weight: bold;
        }
        .time-info {
            text-align: center;
            font-size: 0.9em;
            color: gray;
            margin-top: 10px;
        }
    </style>
<script>
    async function getExchangeRate() {
        document.getElementById("amount").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                getExchangeRate();
            }
        });
        const baseCurrency = document.getElementById("baseCurrency").value;
        const amount = parseFloat(document.getElementById("amount").value) || 1;
        const targetCurrencies = ["KRW", "USD", "CNH", "JPY", "EGP", "THB"];
        // const url = `http://localhost:3000/exchange-rate`;  âŒ ê¸°ì¡´ ì½”ë“œ
		const url = `https://seastorys2.synology.me:3000/exchange-rate`; // âœ… ì´ë ‡ê²Œ ìˆ˜ì •


        try {
            const response = await fetch(url);
            const data = await response.json();

            if (!Array.isArray(data) || data.length === 0) {
                document.getElementById("result").innerText = "í™˜ìœ¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            console.log("API ì‘ë‹µ ë°ì´í„°:", data); // ë°ì´í„° êµ¬ì¡° í™•ì¸ìš©

            let resultHTML = "";

            // ê¸°ì¤€ í†µí™”ì˜ í™˜ìœ¨ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            let baseCurrencyData = data.find(item => item.cur_unit === baseCurrency);
            if (!baseCurrencyData) {
                if (baseCurrency === "CNY") baseCurrencyData = data.find(item => item.cur_unit === "CNH");
                if (baseCurrency === "JPY") baseCurrencyData = data.find(item => item.cur_unit === "JPY(100)");
            }
            if (!baseCurrencyData) {
                document.getElementById("result").innerText = "ê¸°ì¤€ í†µí™”ì˜ í™˜ìœ¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            const baseRate = parseFloat(baseCurrencyData.deal_bas_r.replace(/,/g, ''));

            targetCurrencies.forEach(currency => {
                let searchCurrency = currency;
                if (currency === "CNY") searchCurrency = "CNH"; // CNYê°€ CNHë¡œ ì œê³µë  ê²½ìš° ëŒ€ì‘
                if (currency === "JPY") searchCurrency = "JPY(100)"; // JPYê°€ JPY(100)ìœ¼ë¡œ ì œê³µë  ê²½ìš° ëŒ€ì‘
                
                const currencyData = data.find(item => item.cur_unit === searchCurrency);
                if (!currencyData) {
                    resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>N/A</span></div>`;
                    return;
                }

                let targetRate = parseFloat(currencyData.deal_bas_r.replace(/,/g, ''));
                if (currency === "JPY") targetRate /= 100; // JPY(100) ê¸°ì¤€ì„ JPY(1) ê¸°ì¤€ìœ¼ë¡œ ë³€í™˜

                let convertedAmount;
                if (baseCurrency === "KRW") {
                    // ê¸°ì¤€ í†µí™”ê°€ KRWì¼ ê²½ìš°: KRW â†’ ëŒ€ìƒ í†µí™” ë³€í™˜
                    convertedAmount = (amount / targetRate).toFixed(2);
                } else if (currency === "KRW") {
                    // ëŒ€ìƒ í†µí™”ê°€ KRWì¼ ê²½ìš°: ê¸°ì¤€ í†µí™” â†’ KRW ë³€í™˜
                    convertedAmount = (amount * baseRate).toFixed(2);
                } else {
                    // ê·¸ ì™¸ (ì˜ˆ: USD â†’ CNY ë³€í™˜): ê¸°ì¤€ í†µí™”ë¥¼ KRWë¡œ ë³€í™˜í•œ í›„ ëŒ€ìƒ í†µí™”ë¡œ ë³€í™˜
                    const amountInKRW = amount * baseRate;
                    convertedAmount = (amountInKRW / targetRate).toFixed(2);
                }

                convertedAmount = Number(convertedAmount).toLocaleString();
                let displayAmount = currency === "KRW" ? `${convertedAmount} ì›` : `${convertedAmount} ${currency}`;
                resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>${displayAmount}</span></div>`;
            });

            document.getElementById("result").innerHTML = resultHTML;

            // ğŸ“… ê¸°ì¤€ ì‹œê°„ í‘œì‹œ (ì„œë²„ì—ì„œ ë°›ì€ ìµœì‹  í™˜ìœ¨ ë°ì´í„° ê¸°ì¤€)
            const updateTimeStr = data[0]?.date || new Date().toISOString(); // API ì‘ë‹µ êµ¬ì¡°ì— ë”°ë¼ ìˆ˜ì •
            const updateTime = new Date(updateTimeStr);
            const formattedTime = updateTime.toLocaleString("ko-KR", {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
                hour12: false
            });

            document.getElementById("timeInfo").innerText = `ğŸ“… ìµœì‹  í™˜ìœ¨ ë°ì´í„° ê¸°ì¤€
(ë‚ ì§œ: ${updateTimeStr})`; 

        } catch (error) {
            console.error("API ìš”ì²­ ì˜¤ë¥˜:", error);
            document.getElementById("result").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
        }
    }
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("amount").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            getExchangeRate();
        }
    });
});
</script>
</head>
<body>
    <div class="exchange-container">
        <h2 id="title">í™˜ìœ¨ ë³€í™˜ê¸°</h2>
        <label for="baseCurrency">ê¸°ì¤€ í†µí™”:</label>
        <select id="baseCurrency">
            <option value="KRW">í•œêµ­(KRW)</option>
            <option value="USD">ë¯¸êµ­(USD)</option>
            <option value="CNH">ì¤‘êµ­(CNH)</option>
            <option value="JPY">ì¼ë³¸(JPY)</option>
            <option value="EGP">ì´ì§‘íŠ¸(EGP)</option>
            <option value="THB">íƒœêµ­(THB)</option>
        </select>
        <br><br>
        <label for="amount">ê¸ˆì•¡ ì…ë ¥:</label>
        <input type="number" id="amount" value="" min="0" step="0.01">
        <br><br>
        <button onclick="getExchangeRate()">í™˜ìœ¨ ì¡°íšŒ</button>
        <div id="result"></div>
        <p id="timeInfo" class="time-info"></p>
    </div>
</body>
</html>
