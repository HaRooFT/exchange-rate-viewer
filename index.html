<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>í™˜ìœ¨ ë³€í™˜ê¸°</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .exchange-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      width: 400px;
    }
    h2 {
      text-align: center;
      margin-top: 0;
    }
    label {
      font-size: 1.2em;
    }
    select,
    input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 1.2em;
      margin-top: 5px;
      margin-bottom: 15px;
      box-sizing: border-box;
    }
    .button-group {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 15px;
    }
    button {
      padding: 8px 12px;
      font-size: 1em;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .exchange-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    .exchange-card:last-child {
      border-bottom: none;
    }
    .currency {
      font-weight: bold;
    }
    .amount {
      font-size: 1.2em;
      font-weight: bold;
    }
    .copy-btn {
      margin-left: 10px;
      font-size: 0.9em;
      padding: 4px 8px;
    }
    .time-info {
      text-align: center;
      font-size: 0.9em;
      color: gray;
      margin-top: 10px;
    }

    /* =============== ë¡œê³  ê´€ë ¨ =============== */
    /* ì²˜ìŒì—” ìƒë‹¨ ë¡œê³ ë§Œ ë³´ì´ê³ , í•˜ë‹¨ ë¡œê³ ëŠ” ìˆ¨ê¹€ */
    #topLogoWrapper {
      display: block; 
      text-align: center;
      margin-bottom: 10px;
    }
    #bottomLogoWrapper {
      display: none; 
      text-align: center;
      margin-top: 10px;
    }
    /* ë¡œê³  ì´ë¯¸ì§€ í¬ê¸°ë‚˜ ìŠ¤íƒ€ì¼ì€ ì›í•˜ëŠ” ëŒ€ë¡œ ì¡°ì ˆ */
    /* ìƒë‹¨ ë¡œê³  */
#topLogo {
  max-width: 250px; /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ìˆ˜ì • */
  height: auto;
  /* í•„ìš”í•˜ë‹¤ë©´ margin, padding, border ë“± ììœ ë¡­ê²Œ ì¶”ê°€ */
}

/* í•˜ë‹¨ ë¡œê³  */
#bottomLogo {
  max-width: 200px; /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ìˆ˜ì • */
  height: auto;
  /* í•„ìš”í•˜ë‹¤ë©´ margin, padding, border ë“± ììœ ë¡­ê²Œ ì¶”ê°€ */
}

  </style>

  <script>
    async function getExchangeRate() {
      const baseCurrency = document.getElementById("baseCurrency").value;
      const amountInput = document.getElementById("amount");
      const rawValue = amountInput.value.replace(/,/g, "");
      let amount = parseFloat(rawValue) || 1;

      const targetCurrencies = ["KRW", "USD", "CNH", "JPY", "EGP", "THB"];
      const url = `https://seastorys2.synology.me/exchange-rate`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (!Array.isArray(data) || data.length === 0) {
          document.getElementById("result").innerText =
            "í™˜ìœ¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        let resultHTML = "";

        let baseCurrencyData = data.find((item) => item.cur_unit === baseCurrency);
        if (!baseCurrencyData) {
          if (baseCurrency === "CNY")
            baseCurrencyData = data.find((item) => item.cur_unit === "CNH");
          if (baseCurrency === "JPY")
            baseCurrencyData = data.find((item) => item.cur_unit === "JPY(100)");
        }
        if (!baseCurrencyData) {
          document.getElementById("result").innerText =
            "ê¸°ì¤€ í†µí™”ì˜ í™˜ìœ¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        let baseRate = parseFloat(baseCurrencyData.deal_bas_r.replace(/,/g, ""));
        // ì¼ë³¸(JPY) ê¸°ì¤€ í†µí™”ëŠ” 100ë‹¨ìœ„ -> 100ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì ìš©
        if (baseCurrency === "JPY") {
          baseRate = baseRate / 100;
        }

        // í™˜ìœ¨ ê³„ì‚°
        targetCurrencies.forEach((currency, index) => {
          let searchCurrency = currency;
          if (currency === "CNY") searchCurrency = "CNH";
          if (currency === "JPY") searchCurrency = "JPY(100)";

          const currencyData = data.find((item) => item.cur_unit === searchCurrency);
          if (!currencyData) {
            resultHTML += `<div class='exchange-card'>
              <span class='currency'>${currency}</span> 
              <span class='amount'>N/A</span>
            </div>`;
            return;
          }

          let targetRate = parseFloat(currencyData.deal_bas_r.replace(/,/g, ""));
          if (currency === "JPY") targetRate /= 100;

          let convertedAmount;
          if (baseCurrency === "KRW") {
            convertedAmount = (amount / targetRate).toFixed(2);
          } else if (currency === "KRW") {
            convertedAmount = (amount * baseRate).toFixed(2);
          } else {
            const amountInKRW = amount * baseRate;
            convertedAmount = (amountInKRW / targetRate).toFixed(2);
          }

          convertedAmount = Number(convertedAmount).toLocaleString();
          const displayAmount =
            currency === "KRW"
              ? `${convertedAmount} ì›`
              : `${convertedAmount} ${currency}`;

          resultHTML += `<div class='exchange-card'>
              <span class='currency'>${currency}</span>
              <span class='amount' id="amount-${index}">${displayAmount}</span>
              <button class="copy-btn" onclick="copyToClipboard('amount-${index}')">ë³µì‚¬</button>
            </div>`;
        });

        document.getElementById("result").innerHTML = resultHTML;

        const updateTimeStr = data[0]?.date || new Date().toISOString();
        document.getElementById("timeInfo").innerText = 
          `ğŸ“… ìµœì‹  í™˜ìœ¨ ë°ì´í„° ê¸°ì¤€\n(ë‚ ì§œ: ${updateTimeStr})`;

        // â˜…â˜…â˜… ì¡°íšŒ ì„±ê³µ ì‹œ: ìƒë‹¨ ë¡œê³  ìˆ¨ê¸°ê³ , í•˜ë‹¨ ë¡œê³  ë³´ì´ê¸° â˜…â˜…â˜…
        document.getElementById("topLogoWrapper").style.display = "none";
        document.getElementById("bottomLogoWrapper").style.display = "block";
      } catch (error) {
        console.error("API ìš”ì²­ ì˜¤ë¥˜:", error);
        document.getElementById("result").innerText =
          "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
        // ì—ëŸ¬ ì‹œì—ëŠ” ìƒë‹¨ ë¡œê³  ê·¸ëŒ€ë¡œ, í•˜ë‹¨ ë¡œê³ ë„ ê·¸ëŒ€ë¡œ ìˆ¨ê¹€ ìƒíƒœ ìœ ì§€
      }
    }

    function copyToClipboard(elementId) {
      const el = document.getElementById(elementId);
      const text = el.innerText.replace(/[^0-9.]/g, "");
      navigator.clipboard.writeText(text);
    }

    function clearAmount() {
      const amountInput = document.getElementById("amount");
      amountInput.value = "";
      amountInput.focus();

      // â˜…â˜…â˜… ì§€ìš°ê¸° ë²„íŠ¼ ì‹œ: ìƒë‹¨ ë¡œê³  ë‹¤ì‹œ ë³´ì´ê³ , í•˜ë‹¨ ë¡œê³  ìˆ¨ê¸°ê¸° â˜…â˜…â˜…
      document.getElementById("topLogoWrapper").style.display = "block";
      document.getElementById("bottomLogoWrapper").style.display = "none";

      document.getElementById("result").innerHTML = "";
      document.getElementById("timeInfo").innerText = "";
    }

    function blurInputField() {
      const amountInput = document.getElementById("amount");
      amountInput.blur();
    }

    document.addEventListener("DOMContentLoaded", function () {
      const amountInput = document.getElementById("amount");
      const baseCurrencySelect = document.getElementById("baseCurrency");

      function isDecimalAllowed() {
        // KRW(ì›) ì´ì™¸ì˜ í†µí™”ëŠ” ì†Œìˆ˜ì  ì…ë ¥ ê°€ëŠ¥
        return baseCurrencySelect.value !== "KRW";
      }

      baseCurrencySelect.addEventListener("change", () => {
        amountInput.value = "";
        amountInput.focus();
      });

      amountInput.addEventListener("beforeinput", function (event) {
        const inputChar = event.data;
        if (inputChar === "." && !isDecimalAllowed()) {
          event.preventDefault();
        }
      });

      amountInput.addEventListener("keydown", function (event) {
        const key = event.key;
        if (key === "Enter") {
          event.preventDefault();
          getExchangeRate();
          blurInputField(); // ì…ë ¥ ì™„ë£Œ í›„ í‚¤ë³´ë“œ ë‹«ê¸°
        }
        if (key === "." && !isDecimalAllowed()) {
          event.preventDefault();
        }
      });

      amountInput.addEventListener("input", function () {
        let val = amountInput.value.replace(/,/g, "");
        if (!isDecimalAllowed()) {
          val = val.replace(/\D/g, "");
        } else {
          val = val.replace(/[^\d.]/g, "");
        }
        amountInput.value = val;
      });

      amountInput.focus();
    });

    // ìš°í´ë¦­, F12, ê°œë°œìë„êµ¬ ì—´ê¸° ë°©ì§€ (ë””ë²„ê¹… ìœ„í•´ ì ì‹œ ì£¼ì„ ê°€ëŠ¥)
    document.addEventListener("contextmenu", (e) => e.preventDefault());
    document.addEventListener("selectstart", (e) => e.preventDefault());
    document.addEventListener("keydown", (e) => {
      if (
        e.key === "F12" ||
        (e.ctrlKey && e.shiftKey && ["I", "i", "J", "j", "C", "c"].includes(e.key)) ||
        (e.ctrlKey && e.key.toLowerCase() === "u")
      ) {
        e.preventDefault();
      }
    });
  </script>
</head>
<body>
  <div class="exchange-container">

    <!-- ì²˜ìŒì—ë§Œ ë³´ì´ëŠ” ìƒë‹¨ ë¡œê³  -->
    <div id="topLogoWrapper">
      <!-- ì›í•˜ëŠ” ë¡œê³  URL/í¬ê¸°ë¡œ ìˆ˜ì • -->
      <img
        id="topLogo"
        src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FboSdsB%2FbtsMQn77F7H%2FkkCp2eFn647DAjg3Afie5k%2Fimg.png"
        alt="ìƒë‹¨ ë¡œê³ "
      />
    </div>

    <h2 id="title">í™˜ìœ¨ ë³€í™˜ê¸°</h2>

    <label for="baseCurrency">ê¸°ì¤€ í†µí™”:</label>
    <select id="baseCurrency">
      <option value="KRW">í•œêµ­(KRW)</option>
      <option value="USD">ë¯¸êµ­(USD)</option>
      <option value="CNH">ì¤‘êµ­(CNH)</option>
      <option value="JPY">ì¼ë³¸(JPY)</option>
      <option value="EGP">ì´ì§‘íŠ¸(EGP)</option>
      <option value="THB">íƒœêµ­(THB)</option>
    </select>

    <label for="amount">ê¸ˆì•¡ ì…ë ¥:</label>
    <input type="text" id="amount" inputmode="decimal" placeholder="ê¸ˆì•¡ ì…ë ¥" />

    <div class="button-group">
      <button onclick="clearAmount()">ì§€ìš°ê¸°</button>
      <button onclick="getExchangeRate()">í™˜ìœ¨ ì¡°íšŒ</button>
    </div>

    <!-- ì¡°íšŒ ê²°ê³¼ ì˜ì—­ -->
    <div id="result"></div>
    <p id="timeInfo" class="time-info"></p>

    <!-- ì¡°íšŒ í›„ì—ë§Œ ë³´ì´ëŠ” í•˜ë‹¨ ë¡œê³  -->
    <div id="bottomLogoWrapper">
      <!-- ì›í•˜ëŠ” ë¡œê³  URL/í¬ê¸°ë¡œ ìˆ˜ì • -->
      <img
        id="bottomLogo"
        src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbUbZ7C%2FbtsMPJjN9re%2Flvw7hIiQmwpCYThd9H5YSK%2Fimg.png"
        alt="í•˜ë‹¨ ë¡œê³ "
      />
    </div>
  </div>
</body>
</html>
