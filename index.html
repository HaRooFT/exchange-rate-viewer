<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌôòÏú® Î≥ÄÌôòÍ∏∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .exchange-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            width: 400px;
        }
        h2 {
            text-align: center;
        }
        label {
            font-size: 1.2em;
        }
        select, input[type="text"], input[type="tel"], input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 1.2em;
            margin-top: 5px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 15px;
        }
        button {
            padding: 8px 12px;
            font-size: 1em;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .exchange-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .exchange-card:last-child {
            border-bottom: none;
        }
        .currency {
            font-weight: bold;
        }
        .amount {
            font-size: 1.2em;
            font-weight: bold;
        }
        .copy-btn {
            margin-left: 10px;
            font-size: 0.9em;
            padding: 4px 8px;
        }
        .time-info {
            text-align: center;
            font-size: 0.9em;
            color: gray;
            margin-top: 10px;
        }
    </style>
<script>
    async function getExchangeRate() {
        const baseCurrency = document.getElementById("baseCurrency").value;
        const amountInput = document.getElementById("amount");
        const rawValue = amountInput.value.replace(/,/g, '');
        const amount = parseFloat(rawValue) || 1;
        const targetCurrencies = ["KRW", "USD", "CNH", "JPY", "EGP", "THB"];
        const url = `https://seastorys2.synology.me/exchange-rate`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            if (!Array.isArray(data) || data.length === 0) {
                document.getElementById("result").innerText = "ÌôòÏú® Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.";
                return;
            }

            let resultHTML = "";

            let baseCurrencyData = data.find(item => item.cur_unit === baseCurrency);
            if (!baseCurrencyData) {
                if (baseCurrency === "CNY") baseCurrencyData = data.find(item => item.cur_unit === "CNH");
                if (baseCurrency === "JPY") baseCurrencyData = data.find(item => item.cur_unit === "JPY(100)");
            }
            if (!baseCurrencyData) {
                document.getElementById("result").innerText = "Í∏∞Ï§Ä ÌÜµÌôîÏùò ÌôòÏú® Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.";
                return;
            }

            const baseRate = parseFloat(baseCurrencyData.deal_bas_r.replace(/,/g, ''));

            targetCurrencies.forEach((currency, index) => {
                let searchCurrency = currency;
                if (currency === "CNY") searchCurrency = "CNH";
                if (currency === "JPY") searchCurrency = "JPY(100)";

                const currencyData = data.find(item => item.cur_unit === searchCurrency);
                if (!currencyData) {
                    resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>N/A</span></div>`;
                    return;
                }

                let targetRate = parseFloat(currencyData.deal_bas_r.replace(/,/g, ''));
                if (currency === "JPY") targetRate /= 100;

                let convertedAmount;
                if (baseCurrency === "KRW") {
                    convertedAmount = (amount / targetRate).toFixed(2);
                } else if (currency === "KRW") {
                    convertedAmount = (amount * baseRate).toFixed(2);
                } else {
                    const amountInKRW = amount * baseRate;
                    convertedAmount = (amountInKRW / targetRate).toFixed(2);
                }

                convertedAmount = Number(convertedAmount).toLocaleString();
                const displayAmount = currency === "KRW" ? `${convertedAmount} Ïõê` : `${convertedAmount} ${currency}`;

                resultHTML += `<div class='exchange-card'>
                    <span class='currency'>${currency}</span>
                    <span class='amount' id="amount-${index}">${displayAmount}</span>
                    <button class="copy-btn" onclick="copyToClipboard('amount-${index}')">Î≥µÏÇ¨</button>
                </div>`;
            });

            document.getElementById("result").innerHTML = resultHTML;

            const updateTimeStr = data[0]?.date || new Date().toISOString();
            document.getElementById("timeInfo").innerText = `üìÖ ÏµúÏã† ÌôòÏú® Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä\n(ÎÇ†Ïßú: ${updateTimeStr})`;
        } catch (error) {
            console.error("API ÏöîÏ≤≠ Ïò§Î•ò:", error);
            document.getElementById("result").innerText = "Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•ò Î∞úÏÉù.";
        }
    }

    function copyToClipboard(elementId) {
        const el = document.getElementById(elementId);
        const text = el.innerText.replace(/[^0-9.]/g, '');
        navigator.clipboard.writeText(text);
    }

    function clearAmount() {
        const amountInput = document.getElementById("amount");
        amountInput.value = "";
        amountInput.focus();
    }

    function blurInputField() {
        const amountInput = document.getElementById("amount");
        amountInput.blur();
    }

    document.addEventListener("DOMContentLoaded", function() {
        const amountInput = document.getElementById("amount");
        const baseCurrencySelect = document.getElementById("baseCurrency");

        function isDecimalAllowed() {
            return baseCurrencySelect.value !== "KRW";
        }

        baseCurrencySelect.addEventListener("change", () => {
            amountInput.value = "";
            amountInput.focus();
        });

        amountInput.addEventListener("beforeinput", function(event) {
            const inputChar = event.data;
            if (inputChar === "." && !isDecimalAllowed()) {
                event.preventDefault();
            }
        });

        amountInput.addEventListener("keydown", function(event) {
            const key = event.key;
            if (key === "Enter") {
                event.preventDefault();
                getExchangeRate();
                blurInputField(); // ‚úÖ ÏûÖÎ†• ÏôÑÎ£å ÌõÑ ÌÇ§Î≥¥Îìú Îã´Í∏∞
            }
            if (key === "." && !isDecimalAllowed()) {
                event.preventDefault();
            }
        });

        amountInput.addEventListener("input", function(e) {
            let val = amountInput.value.replace(/,/g, "");
            if (!isDecimalAllowed()) {
                val = val.replace(/\D/g, "");
            } else {
                val = val.replace(/[^\d.]/g, "");
            }
            amountInput.value = val;
        });

        amountInput.focus();
    });

    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("selectstart", e => e.preventDefault());
    document.addEventListener("keydown", e => {
        if (
            e.key === "F12" ||
            (e.ctrlKey && e.shiftKey && ["I", "i", "J", "j", "C", "c"].includes(e.key)) ||
            (e.ctrlKey && e.key.toLowerCase() === "u")
        ) {
            e.preventDefault();
        }
    });
</script>
</head>
<body>
    <div class="exchange-container">
        <h2 id="title">ÌôòÏú® Î≥ÄÌôòÍ∏∞</h2>
        <label for="baseCurrency">Í∏∞Ï§Ä ÌÜµÌôî:</label>
        <select id="baseCurrency">
            <option value="KRW">ÌïúÍµ≠(KRW)</option>
            <option value="USD">ÎØ∏Íµ≠(USD)</option>
            <option value="CNH">Ï§ëÍµ≠(CNH)</option>
            <option value="JPY">ÏùºÎ≥∏(JPY)</option>
            <option value="EGP">Ïù¥ÏßëÌä∏(EGP)</option>
            <option value="THB">ÌÉúÍµ≠(THB)</option>
        </select>

        <label for="amount">Í∏àÏï° ÏûÖÎ†•:</label>
        <input type="text" id="amount" inputmode="decimal" placeholder="Í∏àÏï° ÏûÖÎ†•">

        <div class="button-group">
            <button onclick="clearAmount()">ÏßÄÏö∞Í∏∞</button>
            <button onclick="getExchangeRate()">ÌôòÏú® Ï°∞Ìöå</button>
        </div>

        <div id="result"></div>
        <p id="timeInfo" class="time-info"></p>
    </div>
</body>
</html>
