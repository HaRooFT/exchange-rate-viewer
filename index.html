<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ìœ¨ ë³€í™˜ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .exchange-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            width: 400px;
        }
        h2 {
            text-align: center;
        }
        label {
            font-size: 1.2em;
        }
        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 1.2em;
            margin-top: 5px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 12px;
            font-size: 1.2em;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .exchange-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .exchange-card:last-child {
            border-bottom: none;
        }
        .currency {
            font-weight: bold;
        }
        .amount {
            font-size: 1.2em;
            font-weight: bold;
        }
        .time-info {
            text-align: center;
            font-size: 0.9em;
            color: gray;
            margin-top: 10px;
        }
    </style>
<script>
    async function getExchangeRate() {
        const baseCurrency = document.getElementById("baseCurrency").value;
        const amountInput = document.getElementById("amount");
        const rawValue = amountInput.value.replace(/,/g, '');
        const amount = parseFloat(rawValue) || 1;
        const targetCurrencies = ["KRW", "USD", "CNH", "JPY", "EGP", "THB"];
        const url = `https://seastorys2.synology.me/exchange-rate`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            if (!Array.isArray(data) || data.length === 0) {
                document.getElementById("result").innerText = "í™˜ìœ¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            let resultHTML = "";

            let baseCurrencyData = data.find(item => item.cur_unit === baseCurrency);
            if (!baseCurrencyData) {
                if (baseCurrency === "CNY") baseCurrencyData = data.find(item => item.cur_unit === "CNH");
                if (baseCurrency === "JPY") baseCurrencyData = data.find(item => item.cur_unit === "JPY(100)");
            }
            if (!baseCurrencyData) {
                document.getElementById("result").innerText = "ê¸°ì¤€ í†µí™”ì˜ í™˜ìœ¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            const baseRate = parseFloat(baseCurrencyData.deal_bas_r.replace(/,/g, ''));

            targetCurrencies.forEach(currency => {
                let searchCurrency = currency;
                if (currency === "CNY") searchCurrency = "CNH";
                if (currency === "JPY") searchCurrency = "JPY(100)";

                const currencyData = data.find(item => item.cur_unit === searchCurrency);
                if (!currencyData) {
                    resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>N/A</span></div>`;
                    return;
                }

                let targetRate = parseFloat(currencyData.deal_bas_r.replace(/,/g, ''));
                if (currency === "JPY") targetRate /= 100;

                let convertedAmount;
                if (baseCurrency === "KRW") {
                    convertedAmount = (amount / targetRate).toFixed(2);
                } else if (currency === "KRW") {
                    convertedAmount = (amount * baseRate).toFixed(2);
                } else {
                    const amountInKRW = amount * baseRate;
                    convertedAmount = (amountInKRW / targetRate).toFixed(2);
                }

                convertedAmount = Number(convertedAmount).toLocaleString();
                let displayAmount = currency === "KRW" ? `${convertedAmount} ì›` : `${convertedAmount} ${currency}`;
                resultHTML += `<div class='exchange-card'><span class='currency'>${currency}</span> <span class='amount'>${displayAmount}</span></div>`;
            });

            document.getElementById("result").innerHTML = resultHTML;

            const updateTimeStr = data[0]?.date || new Date().toISOString();
            document.getElementById("timeInfo").innerText = `ğŸ“… ìµœì‹  í™˜ìœ¨ ë°ì´í„° ê¸°ì¤€\n(ë‚ ì§œ: ${updateTimeStr})`;
        } catch (error) {
            console.error("API ìš”ì²­ ì˜¤ë¥˜:", error);
            document.getElementById("result").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        const amountInput = document.getElementById("amount");

        amountInput.addEventListener("input", function() {
            let val = amountInput.value.replace(/,/g, '');
            if (!isNaN(val) && val !== "") {
                amountInput.value = Number(val).toLocaleString();
            }
        });

        amountInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                getExchangeRate();
            }
        });
    });

    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("selectstart", e => e.preventDefault());
    document.addEventListener("keydown", e => {
        if (
            e.key === "F12" ||
            (e.ctrlKey && e.shiftKey && ["I", "i", "J", "j", "C", "c"].includes(e.key)) ||
            (e.ctrlKey && e.key.toLowerCase() === "u")
        ) {
            e.preventDefault();
        }
    });
</script>
</head>
<body>
    <div class="exchange-container">
        <h2 id="title">í™˜ìœ¨ ë³€í™˜ê¸°</h2>
        <label for="baseCurrency">ê¸°ì¤€ í†µí™”:</label>
        <select id="baseCurrency">
            <option value="KRW">í•œêµ­(KRW)</option>
            <option value="USD">ë¯¸êµ­(USD)</option>
            <option value="CNH">ì¤‘êµ­(CNH)</option>
            <option value="JPY">ì¼ë³¸(JPY)</option>
            <option value="EGP">ì´ì§‘íŠ¸(EGP)</option>
            <option value="THB">íƒœêµ­(THB)</option>
        </select>

        <label for="amount">ê¸ˆì•¡ ì…ë ¥:</label>
        <input type="number" id="amount" inputmode="numeric" pattern="[0-9]*" min="0" step="0.01">

        <button onclick="getExchangeRate()">í™˜ìœ¨ ì¡°íšŒ</button>
        <div id="result"></div>
        <p id="timeInfo" class="time-info"></p>
    </div>
</body>
</html>
